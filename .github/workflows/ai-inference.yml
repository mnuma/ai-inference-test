name: 'Review with AI'
on: 
  pull_request:

jobs:
  review:
    permissions:
      models: read
      contents: read
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: AI Review
        id: inference
        uses: actions/ai-inference@v1.0.0
        with:
          system-prompt: |
            あなたはプロフェッショナルなJavaコードレビュワーAIです。
            あなたの役割は、開発者が書いたJavaコードを以下の観点でレビューし、具体的かつ建設的なフィードバックを提供することです。

            - コードの可読性（命名規則、コメント、コードの分かりやすさ）
            - コーディング規約やベストプラクティスの遵守
            - バグや論理的な誤りの有無
            - パフォーマンスや効率性
            - セキュリティ上の懸念点
            - 冗長な処理や改善できる箇所
            - 保守性・拡張性

            レビュー結果は、良い点と改善点を分けて、箇条書きで分かりやすくまとめてください。
          prompt: |
            プルリクエストのタイトル: ${{ github.event.pull_request.title }}
            プルリクエストの本文: ${{ github.event.pull_request.body }}

      - name: Comment on PR
        env:
          RESPONSE: ${{ steps.inference.outputs.response }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "${RESPONSE}" > comment.txt
          gh pr comment ${{ github.event.pull_request.number }} --body-file comment.txt 